<?php
// 1️⃣ Добавляем вкладку в меню ЛК
add_filter('woocommerce_account_menu_items', function ($items) {
    $items['favorites'] = 'Избранное'; // добавляем вкладку
    return $items;
}, 20);

// 2️⃣ Регистрируем endpoint для вкладки
add_action('init', function () {
    add_rewrite_endpoint('favorites', EP_PAGES);
});

// 3️⃣ Выводим контент вкладки напрямую
add_action('woocommerce_account_favorites_endpoint', function () {

    echo '<h3>Избранное</h3>';
    echo do_shortcode('[custom_wishlist]'); // сюда вставьте ваш шорткод

});

// Поле ФИО в анкете пользователя
add_action('woocommerce_edit_account_form', function () {

    $user_id   = get_current_user_id();
    $full_name = get_user_meta($user_id, 'account_full_name', true);
?>
    <p class="woocommerce-form-row woocommerce-form-row--wide form-row form-row-wide">
        <label for="account_full_name">
            Имя и фамилия <span class="required">*</span>
        </label>
        <input
            type="text"
            class="woocommerce-Input woocommerce-Input--text input-text"
            name="account_full_name"
            id="account_full_name"
            value="<?php echo esc_attr($full_name); ?>"
            placeholder="Ф.И.О."
            required />
    </p>
<?php
});

// Сохраняем ФИО пользователя
add_action('woocommerce_save_account_details', function ($user_id) {

    if (isset($_POST['account_full_name'])) {
        update_user_meta(
            $user_id,
            'account_full_name',
            sanitize_text_field($_POST['account_full_name'])
        );
    }
});

//Вывод ФИО на странице «Анкета» (просмотр)
$user_id   = get_current_user_id();
$full_name = get_user_meta($user_id, 'account_full_name', true);

if ($full_name) {
    echo '<p><strong>Имя и фамилия:</strong> ' . esc_html($full_name) . '</p>';
}

// Подставляем ФИО из аккаунта в оформление заказа
add_filter('woocommerce_checkout_get_value', function ($value, $input) {

    if ($input === 'billing_full_name' && is_user_logged_in()) {
        $full_name = get_user_meta(get_current_user_id(), 'account_full_name', true);
        if ($full_name) {
            return $full_name;
        }
    }

    return $value;
}, 10, 2);


//----------МЕНЮ ЛИЧНОГО КАБИНЕТА--------------//

add_filter('woocommerce_account_menu_items', function ($items) {

    $ordered = [];

    // 1. Мои данные
    if (isset($items['edit-account'])) {
        $ordered['edit-account'] = 'Мои данные';
    }

    // 2. Заказы
    if (isset($items['orders'])) {
        $ordered['orders'] = 'Заказы';
    }

    // 3. Избранное
    if (isset($items['favorites'])) {
        $ordered['favorites'] = 'Избранное';
    }

    // 4. Обращения — ТОЛЬКО если плагин добавил endpoint
    if (isset($items['support'])) {
        $ordered['support'] = 'Обращения';
    }

    // 5. Выход
    if (isset($items['customer-logout'])) {
        $ordered['customer-logout'] = 'Выход';
    }

    return $ordered;
}, 100);

//------SVG для пункта ---------------//

function my_account_svg($endpoint)
{
    $icons = [
        'edit-account' => '<svg width="20" height="22" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.611 6.28422C14.611 2.81354 12.434 0 9.74859 0C7.06318 0 4.88623 2.81354 4.88623 6.28422C4.88623 9.7549 7.06318 12.5684 9.74859 12.5684C12.434 12.5684 14.611 9.7549 14.611 6.28422Z" fill="#BDBFC1"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.81902 13.8005H12.6784C16.4292 13.8005 19.4974 16.8688 19.4974 20.6196V20.6199C19.4974 20.9469 19.2306 21.2137 18.9037 21.2137H0.593763C0.266834 21.2137 0 20.9469 0 20.6199V20.6196C0 16.8688 3.06822 13.8005 6.81902 13.8005Z" fill="#BDBFC1"/>
</svg>
',
        'orders' => '<svg width="25" height="23" viewBox="0 0 25 23" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0.637207 0.774597C1.68049 -0.328008 1.58381 -0.211702 2.65674 0.858582C2.83635 1.03787 3.56964 1.81988 3.71924 1.88788C4.03195 1.62159 4.82285 0.791641 5.20264 0.410339C5.70416 -0.0930713 5.85993 -0.160609 6.41357 0.388855C6.88107 0.852573 7.46398 1.47276 7.9126 1.88397L8.90967 0.900574C9.2025 0.607744 9.68679 0.0185679 10.0122 0.0148315C10.3115 0.01143 10.4725 0.252792 10.6108 0.388855C10.8839 0.658207 12.0086 1.82492 12.146 1.88788C12.4763 1.59687 12.8178 1.22138 13.1401 0.898621C13.4444 0.594397 13.917 0.00964909 14.2417 0.0148315C14.5297 0.019367 14.709 0.259438 14.8413 0.389832L16.3413 1.88397L17.5132 0.725769C17.7392 0.498635 18.4309 -0.425613 18.8882 0.258972C19.0515 0.503508 18.9724 2.10287 18.9731 2.52655C18.9826 6.42088 18.9365 10.3475 18.9751 14.2316C20.5038 14.3774 21.7357 13.8942 22.8657 14.9572C23.1389 15.2142 23.362 15.4829 23.5649 15.8312C24.4486 17.3479 24.4465 19.304 23.7065 20.8029C23.3044 21.617 22.5144 22.5017 21.3745 22.6359C20.7827 22.7055 18.1079 22.6613 17.2856 22.6662C13.1656 22.6915 8.99477 22.6563 4.87061 22.6642C3.4171 22.6673 2.35807 22.8173 1.44385 21.9709C1.09579 21.6485 0.806149 21.3268 0.550293 20.8C-0.0619905 19.5384 0.00729365 18.6 0.012207 17.2141L0.0112305 10.9894C0.0282374 8.2279 -0.00410219 5.46328 0.0102539 2.70135C0.017435 1.37058 -0.150447 1.60723 0.637207 0.774597ZM5.27783 18.2101C5.18146 16.8828 4.40829 15.067 2.94873 15.3137C1.71556 15.5219 0.976036 17.1989 1.07568 18.7141C1.16186 20.0244 1.97461 21.8413 3.40479 21.5881C4.62224 21.3724 5.38616 19.7006 5.27783 18.2101ZM3.04834 16.8859C3.74831 16.7412 4.17348 17.6138 4.22412 18.2707C4.2823 19.019 3.93912 19.8578 3.35596 20.0041C1.97096 20.351 1.61938 17.1811 3.04834 16.8859ZM20.0132 15.2892L5.29541 15.2961C5.36872 15.4608 5.70166 15.7833 5.90576 16.3391C9.95919 16.3659 14.0628 16.3291 18.1245 16.342L22.6157 16.34C22.5092 16.0483 22.1367 15.7004 21.9175 15.5549C21.4016 15.2121 20.7154 15.2911 20.0132 15.2892ZM3.43701 7.64276C2.81096 7.64276 2.3025 7.90152 2.30225 8.22089C2.30225 8.54036 2.8108 8.79999 3.43701 8.79999H15.7241C16.3502 8.79991 16.8579 8.54031 16.8579 8.22089C16.8577 7.90157 16.35 7.64284 15.7241 7.64276H3.43701ZM3.43701 5.21503C2.8108 5.21503 2.30225 5.47368 2.30225 5.79315C2.30229 6.11261 2.81082 6.37128 3.43701 6.37128H15.7241C16.3502 6.3712 16.8579 6.11256 16.8579 5.79315C16.8579 5.47373 16.3502 5.21511 15.7241 5.21503H3.43701Z" fill="#BDBFC1"/>
</svg>

',
        'favorites' => '<svg width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M11.3386 1.91698C11.6126 1.63201 11.9048 1.37613 12.2207 1.14936C13.2854 0.384006 14.5141 0 16.1027 0C17.8779 0 19.4978 0.659151 20.6808 1.7212C21.9129 2.83049 22.6772 4.37669 22.6772 6.09297C22.6772 8.7171 21.3143 11.2252 19.2745 13.6706C17.382 15.9409 14.9631 18.116 12.548 20.2862C11.8515 20.9125 10.8015 20.8981 10.1231 20.2802C7.7091 18.1111 5.29398 15.9387 3.40233 13.6706C1.36252 11.2252 0 8.7171 0 6.09297C0 4.37669 0.763842 2.82935 1.99748 1.72232C3.17934 0.659143 4.80151 0 6.57449 0C8.16416 0 9.39288 0.384006 10.4572 1.14936C10.7724 1.37613 11.0646 1.63201 11.3386 1.91698Z" fill="#BDBFC1"/>
</svg>',
        'support' => '<svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0.912109 5.28522C4.22595 -0.462988 13.4549 -1.60014 18.9541 2.25592C20.7127 3.48918 22.5053 5.47038 22.6689 8.45319C22.8052 10.9398 21.2541 13.5689 19.2422 14.9571C16.8487 16.608 14.6211 17.3515 11.4619 17.42C11.1109 17.4275 10.5349 17.4165 10.2061 17.3829C8.89078 17.2476 9.33723 17.1463 8.1875 17.7344C7.54658 18.0623 4.16469 19.8438 3.91602 19.8839L3.91406 15.3028C2.85589 14.4967 2.14743 13.9884 1.37305 12.8682C-0.20823 10.5794 -0.505865 7.74525 0.912109 5.28522ZM7.74512 10.421C7.37895 10.421 7.08231 10.6798 7.08203 10.9991C7.08203 11.3186 7.37878 11.5782 7.74512 11.5782H14.9326C15.2988 11.5781 15.5957 11.3185 15.5957 10.9991C15.5954 10.6799 15.2987 10.4211 14.9326 10.421H7.74512ZM6.56152 6.55084C6.07454 6.55084 5.67969 6.81047 5.67969 7.12994C5.67988 7.44931 6.07466 7.70807 6.56152 7.70807H16.1162C16.6031 7.70807 16.9979 7.44931 16.998 7.12994C16.998 6.81047 16.6032 6.55084 16.1162 6.55084H6.56152Z" fill="#BDBFC1"/>
</svg>
',
        'customer-logout' => '<svg width="26" height="23" viewBox="0 0 26 23" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.6626 7.49635V4.40356V3.17329C7.6626 2.3006 8.02052 1.50617 8.59501 0.93093C9.16836 0.357954 9.9632 0 10.8359 0H22.5335C23.4036 0 24.1973 0.357954 24.7718 0.93093C25.3489 1.50958 25.7068 2.30286 25.7068 3.17329V19.5043C25.7068 20.3766 25.3489 21.1714 24.7755 21.7452C24.2007 22.3197 23.4058 22.6772 22.5335 22.6772H10.8359C9.9666 22.6772 9.17327 22.3185 8.59841 21.7452C8.02052 21.1658 7.6626 20.3732 7.6626 19.5043V19.3111V15.1824V14.0315H17.2195C18.02 14.0315 18.6754 13.3769 18.6754 12.576V10.1016C18.6754 9.30106 18.0189 8.64644 17.2195 8.64644H7.6626V7.49635Z" fill="#BDBFC1"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.87819 7.8399C6.22326 7.51335 6.23838 6.96758 5.91182 6.62288C5.58527 6.27781 5.03951 6.26271 4.69444 6.58926L0.27088 10.7683C-0.0749471 11.0948 -0.092333 11.6428 0.234218 11.989C1.64512 13.3999 3.23743 14.826 4.69444 16.2047C5.03951 16.5313 5.58527 16.5162 5.91182 16.1711C6.23838 15.8264 6.22326 15.2806 5.87819 14.9541L2.12058 11.3972L5.87819 7.8399Z" fill="#BDBFC1"/>
<path d="M16.1849 12.1965C16.6604 12.1954 17.0444 11.8065 17.0432 11.3314C17.0421 10.856 16.6532 10.4716 16.1781 10.4727L0.85931 10.5351C0.384223 10.5362 -0.000154794 10.9251 0.000979065 11.4006C0.00211292 11.8757 0.391026 12.26 0.866491 12.2589L16.1849 12.1965Z" fill="#BDBFC1"/>
</svg>',
    ];
    return $icons[$endpoint] ?? '';
}
